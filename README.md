# testovoe-sber
## 1. Краткая документация по использованию Telegram-бота-агента

### Установка и настройка

1. Склонируйте репозиторий:

   ```bash
   git clone <repo_url>
   cd project_folder
   ```
2. Создайте и активируйте виртуальное окружение:

   ```bash
   python3 -m venv venv
   source venv/bin/activate    # Linux/macOS
   venv\\Scripts\\activate    # Windows
   ```
3. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```
4. Задайте переменные окружения:

   * `GIGACHAT_CREDENTIALS` — ваши креденшлы GigaChat.
   * `TELEGRAM_TOKEN` — токен вашего Telegram-бота.

### Структура проекта

```
.
├── bot.py            # Точка входа: Telegram-бот
├── config.py         # Переменные окружения и настройки модели
├── deposit_db.py     # Мок-база вкладов
├── tools.py          # Инструменты (LangChain tools)
├── rag.py            # RAG: загрузка документов и RetrievalQA
└── requirements.txt  # Зависимости
```

### Запуск бота

```bash
python bot.py
```

После запуска бот начнет опрашивать Telegram API и отвечать на сообщения.

### Основные команды и сценарии

* `/start` — приветственное сообщение и краткая справка.
* Любой текстовый запрос — агент в стиле ReAct уточнит параметры и применит инструменты:

  * `list_deposit_names()` — список доступных вкладов.
  * `recommend_deposits(currency, term, replenishment, partial)` — рекомендации.
  * `calculate_final_amount(amount, rate, term)` — расчёт итоговой суммы.
  * `ask_rag_about_deposits(query)` — подробная информация по RAG.

---

## 2. Отчет о процессе разработки

### 2.1 Цели и задачи

* Создать интеллектуального помощника для подбора банковских вкладов.
* Интегрировать LLM (GigaChat) с инструментами (ReAct-подход).
* Обернуть логику агента в удобный Telegram-бот.

### 2.2 Этапы разработки

1. **Прототип агента**:

   * Разработка mock-базы (`deposit_db.py`).
   * Реализация основных инструментов в `tools.py`.
2. **RAG-модуль**:

   * Подготовка текстов с описанием продуктов.
   * Настройка `rag.py` с FAISS и HuggingFaceEmbeddings.
3. **Обёртка в ReAct-агент**:

   * Использовали `langgraph.prebuilt.create_react_agent`.
   * Добавили `MemorySaver` для хранения контекста.
4. **Telegram-бот**:

   * Настройка `python-telegram-bot v20` в `bot.py`.
   * Обработчики `/start` и текстовых сообщений.
   * Передача `thread_id` для чекпоинтера.

### 2.3 Использованные технологии

* **Языки и библиотеки**: Python, python-telegram-bot, langchain-community, gigachat, langgraph, faiss-cpu, sentence-transformers.
* **Модели**: GigaChat-2-Pro (через API GigaChat), Rubert-tiny для эмбеддингов.
* **Хранение контекста**: FAISS для RAG и MemorySaver для ReAct.

### 2.4 Результаты тестирования

* **Функциональные тесты**:

  * Запрос списка вкладов — верный вывод.
  * Рекомендации по разным комбинациям параметров — корректные предложения.
  * Расчет итоговой суммы — совпадение с ручными расчетами.
  * RAG-запросы — релевантные фрагменты из базы знаний.
* **Интеграционные тесты**:

  * Взаимодействие бота в Telegram — запросы `/start` и сообщения обрабатываются без ошибок.
  * Чекпоинтер сохраняет контекст диалога между запросами.

### 2.5 Выводы и дальнейшие шаги

* Агент корректно подбирает и описывает вклады, а бот стабильно отвечает в Telegram.
* Возможные улучшения:

  * Добавить обработку ошибок инструментов и таймауты. (Логирование минимальное добавил)
  * Расширить базу вкладов реальными данными (Я сделал парсер, но по хорошему это должны быть API, у нас структура всех вкладок разная)

---
